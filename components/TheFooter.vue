<!--
    Footer of the page
-->

<template>
    <footer class="mx-x_padding_page mt-inner_space pb-4 h-fit">

        <div class="flex flex-row space-x-inner_space">
            <div class="basis-1/2 flex flex-col space-y-inner_space grow">
                <div class="bg-yellow rounded-card_radius px-12 grow text-black flex flex-col justify-center space-y-8">
                    <h1 class="text-5xl leading-tight font-bold">Let's Connect!</h1>
                    <h3 class="text-2xl leading-tight font-semibold">Feel free to reach out for collaborations,
                        opportunities, or just a friendly chat about all
                        things tech. I'm excited to connect with fellow enthusiasts and professionals.</h3>
                </div>
                <div class="flex flex-row space-x-inner_space">
                    <div class="grow bg-background-light rounded-card_radius">

                    </div>
                    <NuxtLink to="https://github.com/angelocapponcelli" target="_blank"
                        class="basis-1/12 bg-background-light fill-white rounded-card_radius aspect-square p-2 hover:bg-green transition duration-200">
                        <svg class="h-full w-full" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                            <path
                                d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z" />
                        </svg>
                    </NuxtLink>
                    <NuxtLink
                        to="https://it.linkedin.com/in/angelo-capponcelli-9a8657144?trk=public-profile-badge-profile-badge-view-profile-cta"
                        target="_blank"
                        class="basis-1/12 bg-background-light fill-white rounded-card_radius aspect-square p-2 hover:bg-purple transition duration-200">
                        <svg class="h-full w-full" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                            <path
                                d="M4.98 3.5c0 1.381-1.11 2.5-2.48 2.5s-2.48-1.119-2.48-2.5c0-1.38 1.11-2.5 2.48-2.5s2.48 1.12 2.48 2.5zm.02 4.5h-5v16h5v-16zm7.982 0h-4.968v16h4.969v-8.399c0-4.67 6.029-5.052 6.029 0v8.399h4.988v-10.131c0-7.88-8.922-7.593-11.018-3.714v-2.155z" />
                        </svg>
                    </NuxtLink>
                    <NuxtLink to="https://www.instagram.com/angelo.capponcelli/" target="_blank"
                        class="basis-1/12 bg-background-light fill-white rounded-card_radius aspect-square p-2 hover:bg-pink transition duration-200">
                        <svg class="h-full w-full" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                            <path
                                d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z" />
                        </svg>
                    </NuxtLink>
                    <NuxtLink to="mailto:angelocapponcelli@gmail.com" target="_blank"
                        class="basis-1/12 bg-background-light fill-white rounded-card_radius aspect-square p-2 hover:bg-yellow hover:fill-background-light transition duration-200">
                        <svg class="h-full w-full" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                            <path
                                d="M12.042 23.648c-7.813 0-12.042-4.876-12.042-11.171 0-6.727 4.762-12.125 13.276-12.125 6.214 0 10.724 4.038 10.724 9.601 0 8.712-10.33 11.012-9.812 6.042-.71 1.108-1.854 2.354-4.053 2.354-2.516 0-4.08-1.842-4.08-4.807 0-4.444 2.921-8.199 6.379-8.199 1.659 0 2.8.876 3.277 2.221l.464-1.632h2.338c-.244.832-2.321 8.527-2.321 8.527-.648 2.666 1.35 2.713 3.122 1.297 3.329-2.58 3.501-9.327-.998-12.141-4.821-2.891-15.795-1.102-15.795 8.693 0 5.611 3.95 9.381 9.829 9.381 3.436 0 5.542-.93 7.295-1.948l1.177 1.698c-1.711.966-4.461 2.209-8.78 2.209zm-2.344-14.305c-.715 1.34-1.177 3.076-1.177 4.424 0 3.61 3.522 3.633 5.252.239.712-1.394 1.171-3.171 1.171-4.529 0-2.917-3.495-3.434-5.246-.134z" />
                        </svg>
                    </NuxtLink>
                </div>
            </div>

            <div class="basis-1/2 bg-background-light rounded-card_radius p-7">
                <Transition name="hidden-form" @after-leave="toggleAnimation">
                    <form v-show="!isClosed" ref="form" @submit.prevent="sendEmail"
                        class="w-full mx-auto flex flex-col justify-center">
                        <div class="flex flex-col space-y-5">
                            <div class="flex flex-row gap-4">
                                <div class="w-1/2">
                                    <label htmlFor="name" class="block font-semibold text-sm mb-3">
                                        Your Name
                                        <span class="text-red">
                                            {{ form_name.errormsg }}
                                        </span>
                                    </label>
                                    <input v-model="form_name.value"
                                        :class="{ 'error': !isValid(form_name) && form_name.isModified }" id="name"
                                        name="name" type="text" placeholder="Enter Your Name"
                                        class="py-2 px-5 w-full border text-input text-sm placeholder-body min-h-12 bg-transparent border-white focus:outline-none  h-12 rounded-full"
                                        autoComplete="off" spellCheck="false" aria-invalid="false" />
                                </div>
                                <div class="w-1/2">
                                    <label htmlFor="email" class="block font-semibold text-sm mb-3">
                                        Your Email
                                        <span class="text-red">
                                            {{ form_email.errormsg }}
                                        </span>
                                    </label>
                                    <input v-model.trim="form_email.value"
                                        :class="{ 'error': !isValid(form_email) && form_email.isModified }" id="email"
                                        name="email" type="email" placeholder="Enter Your Email"
                                        class="py-2 px-5 w-full border text-input text-sm placeholder-body min-h-12 bg-transparent border-white focus:outline-none  h-12 rounded-full"
                                        autoComplete="off" spellCheck="false" aria-invalid="false" />
                                </div>
                            </div>
                            <div class="relative mb-4">
                                <label htmlFor="message" class="block font-semibold text-sm mb-3">
                                    Message
                                    <span class="text-red">
                                        {{ form_text.errormsg }}
                                    </span>
                                </label>
                                <textarea id="message" name="message" v-model="form_text.value"
                                    :class="{ 'error': !isValid(form_text) && form_text.isModified }"
                                    class="px-4 py-3 flex items-center w-full text-heading text-sm bg-transparent border focus:outline-none focus:border-heading placeholder-body rounded-3xl h-36"
                                    autoComplete="off" spellCheck="false" rows={6}
                                    placeholder="Write your message here"></textarea>
                            </div>
                            <div class="flex justify-end">
                                <button data-variant="flat" v-if="!isWaiting" type="submit"
                                    class="text-yellow py-2 px-3 rounded-full flex flex-row space-x-2 hover:text-black hover:bg-yellow transition duration-200">
                                    <span>Send message</span>
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                        stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                                        <path stroke-linecap="round" stroke-linejoin="round"
                                            d="M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5" />
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </form>
                </Transition>
                <Transition name="hidden-msg">
                    <div v-show="isToggled">
                        <p class="p-4 text-xl text-center">Thank you for getting in touch! <br>
                            Your message has been successfully sent, and I will respond to your request as soon as possible.
                        </p>
                        <div class="flex justify-center">
                            <dotlottie-player v-show="isToggled"
                                src="https://lottie.host/80f38d3d-247f-408e-950f-63f21e24adf1/AeIWlzMBo5.json"
                                background="Transparent" speed="1" style="width: 300px; height: 300px" direction="1"
                                mode="normal" loop autoplay></dotlottie-player>
                        </div>

                    </div>
                </Transition>
            </div>
        </div>
        <p class="w-full text-center pt-5 text-color-600">This site was crafted by yours truly :)</p>

    </footer>
</template>

<script>
import emailjs from '@emailjs/browser';

export default {
    data() {
        return {
            form_name: {
                value: "", //its value
                errormsg: "", //its error message
                isModified: false, //if the field have been touched at least once
                typeText: 'short' //it can be of type short, long, email
            },
            form_email: {
                value: "", //its value
                errormsg: "", //its error message
                isModified: false, //if the field have been touched at least once
                typeText: 'email' //it can be of type short, long, email
            },
            form_text: {
                value: "", //its value
                errormsg: "", //its error message
                isModified: false, //if the field have been touched at least once
                typeText: 'long' //it can be of type short, long, email
            },
            isClosed: false,
            isToggled: false,
            isWaiting: false,
        }
    },
    mounted() {
        let recaptchaScript = document.createElement('script')
        recaptchaScript.setAttribute('src', 'https://unpkg.com/@dotlottie/player-component@latest/dist/dotlottie-player.mjs')
        recaptchaScript.setAttribute('type', 'module')
        document.head.appendChild(recaptchaScript)
    },
    methods: {
        sendEmail() {

            this.form_name.isModified = true;
            this.form_email.isModified = true;
            this.form_text.isModified = true;

            if (this.isValid(this.form_name) &&
                this.isValid(this.form_email) &&
                this.isValid(this.form_text)) {
                this.isWaiting = true;

                //await new Promise(r => setTimeout(r, 1000));//force animation for demo porpouse
                var context = this;
                context.isClosed = true;

                emailjs.sendForm('service_sl20z59'/*'YOUR_SERVICE_ID'*/, 'template_0p6cw89'/*'YOUR_TEMPLATE_ID'*/, this.$refs.form, 'sSHYFp1Oo3xEfi5B4' /*'YOUR_PUBLIC_KEY'*/)
                    .then((result) => {
                        //alert('SUCCESS!', result.text); TODO

                    }, (error) => {
                        alert('FAILED...', error.text);
                    });
            } else {/* alert('Not send'); TODO */ }
        },
        toggleAnimation() {
            this.isToggled = true;
        },
        isRequired(object) {
            return object.value.length === 0 || !object.isModified;
        },
        isValid(object, required = true) {
            if (!object.isModified) {
                return false;
            }
            switch (object.typeText) {
                case 'long':
                    if (object.value.replaceAll(" ", "").length < 5) {
                        object.errormsg = "too short";
                        return false;
                    }
                    if (object.value.replaceAll(" ", "").length > 300) {
                        object.errormsg = "too long"
                        return false;
                    }
                    break;
                case 'short':
                    if (object.value.replaceAll(" ", "").length < 1) {
                        if (required) {
                            object.errormsg = "cannot be empty";
                        }
                        return !required;
                    }
                    if (object.value.replaceAll(" ", "").length > 30) {
                        object.errormsg = "too long"
                        return false;
                    }
                    break;
                case 'email':
                    const validate = (email) => {
                        return String(email)
                            .toLowerCase()
                            .match(
                                /^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|.(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/
                            );
                    };
                    if (object.value.replaceAll(" ", "").length < 1) {
                        object.errormsg = "cannot be empty";
                        return false;
                    }
                    if (validate(object.value) === null) {
                        object.errormsg = "must be valid"
                        return false;
                    }
                    break;
            }

            object.errormsg = "";
            return true;
        },
        onresize(event) {
            if (window.innerWidth >= 576) {
                this.numberSlides = 3;
                return;
            }
            this.numberSlides = 1;
        }
    },
    watch: {
        'form_name.value'(newValue, oldValue) {
            this.form_name.isModified = true;
        },
        'form_email.value'(newValue, oldValue) {
            this.form_email.isModified = true;
        },
        'form_text.value'(newValue, oldValue) {
            this.form_text.isModified = true;
        }
    },
}
</script>
